<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Schedulers | Sean Kim </title> <meta name="author" content="Sean Kim"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://seanshnkim.github.io/blog/2025/Schedulers/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Sean</span> Kim </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/post/index.html">post </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Schedulers</h1> <p class="post-meta"> Created in February 15, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/schedulers"> <i class="fa-solid fa-hashtag fa-sm"></i> Schedulers</a>   ·   <a href="/blog/category/rtos"> <i class="fa-solid fa-tag fa-sm"></i> RTOS</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="scheduler">Scheduler</h2> <p>In this chapter, we are going to discuss scheduler. Task scheduler is the core part of RTOS. In fact, the key role of operating system is to 각 task에게 CPU 자원과 시간을 잘 배분하는 것이라고 할 수 있다. 근데 그러려면 일단 키워드부터 알아야 한다.</p> <h2 id="tick-the-heartbeat-of-rtos">Tick, the heartbeat of RTOS</h2> <p>How does a computer know how long the time elapsed? When does a computer know that it must perform designated tasks?</p> <p>There is a clock inside computer, and tick tells computer how long it took.</p> <ol> <li>Timer: From LED dimming to Pulse Width Modulation (PWM) and a calendar in a smart watch, timer is an essential feature. Tick enables timer, because it is the basic unit of time count.</li> <li>Time delays: Tasks sometimes need to be delayed. In other words, they are assigned a specific number of clock ticks to wait before execution.</li> <li>Context Switching: This is more in-depth (심화 내용) part. The interrupt happens at a certain tick, and it enables to switch between different tasks. If there is a higher priority task needs to run, the tick interrupt allows the RTOS to determine.</li> </ol> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/post-attachments/Scheduler/tick_1-480.webp 480w,/assets/post-attachments/Scheduler/tick_1-800.webp 800w,/assets/post-attachments/Scheduler/tick_1-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/post-attachments/Scheduler/tick_1.png" class="img-fluid rounded z-depth-1 center-image" width="300px" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/post-attachments/Scheduler/tick_2-480.webp 480w,/assets/post-attachments/Scheduler/tick_2-800.webp 800w,/assets/post-attachments/Scheduler/tick_2-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/post-attachments/Scheduler/tick_2.png" class="img-fluid rounded z-depth-1 center-image" width="300px" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>I took only a few examples, but in fact tick is like heartbeat of RTOS, 중추 역할을 한다. Tick drives internal RTOS functionalities, ranging from task management to system monitoring. And the function that generates tick is actually named “TickISR (Interrupt Service Routine)”.<sup id="fnref:3"><a href="#fn:3" class="footnote" rel="footnote" role="doc-noteref">1</a></sup></p> <h2 id="how-is-scheduler-actually-implemented-in-freertos">How is scheduler actually implemented in FreeRTOS?</h2> <p>Now theoretical part is explained, it is time to dissect how it is actually implemented in code. Let’s look into <code class="language-plaintext highlighter-rouge">main.c</code> code.</p> <h3 id="1-vtaskstartscheduler">1. <code class="language-plaintext highlighter-rouge">vTaskStartScheduler()</code> </h3> <p>This function is defined in <code class="language-plaintext highlighter-rouge">tasks.c</code> of FreeRTOS kernel (<code class="language-plaintext highlighter-rouge">FreeRTOS &gt; tasks.c</code>) and used to start the RTOS scheduler.</p> <blockquote> <p>A FreeRTOS application will start up and execute just like a non-RTOS application until <a href="https://www.freertos.org/Documentation/02-Kernel/04-API-references/04-RTOS-kernel-control/03-vTaskStartScheduler" rel="external nofollow noopener" target="_blank">vTaskStartScheduler()</a> is called. vTaskStartScheduler() is normally called from the application’s main() function. The RTOS only controls the execution sequencing after vTaskStartScheduler() has been called. <sup id="fnref:1"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">2</a></sup></p> </blockquote> <p>First, it creates the idle and timer daemon task. Then it calls <code class="language-plaintext highlighter-rouge">xPortStartScheduler()</code> to do the architecture specific initializations. To be more specific, it:</p> <ol> <li>configures <code class="language-plaintext highlighter-rouge">SysTick</code> timer to issue interrupts at a desired rate. This is configured in the variable <code class="language-plaintext highlighter-rouge">FreeRTOSConfig.h &gt; configTick_RATE_HZ</code>.</li> <li>configures priority for PendSV and Systick interrupts. This is implemented as saving priority value in a register: <code class="language-plaintext highlighter-rouge">portNVIC_SHPR3_REG |= portNVIC_PENDSV_PRI</code>, <code class="language-plaintext highlighter-rouge">portNVIC_SHPR3_REG |= portNVIC_SYSTICK_PRI</code>.</li> <li>starts the first task by executing the SVC instruction. (<code class="language-plaintext highlighter-rouge">prvPortStartFirstTask</code>)</li> </ol> <p>As said, <code class="language-plaintext highlighter-rouge">port.c</code> provides hardware-specific implementations for RTOS. In <code class="language-plaintext highlighter-rouge">port.c</code> (<code class="language-plaintext highlighter-rouge">FreeRTOS (Kernel) &gt; portable &gt; RVDS &gt; ARM_CM4F &gt; port.c</code>), and you will be able to find the following three key functions:</p> <ol> <li>vPortSVCHandler():</li> <li>xPortPendSVHandler():</li> <li>xPortSysTickHandler()</li> </ol> <p>Though their names are quite unfamiliar (알아듣기 어렵지만), each of its role is simple and clear.</p> <h3 id="2-starting-pointvportsvchandler">2. Starting point: <code class="language-plaintext highlighter-rouge">vPortSVCHandler()</code> </h3> <p><code class="language-plaintext highlighter-rouge">vPortSVCHandler()</code> is the starting point of FreeRTOS scheduler. If <code class="language-plaintext highlighter-rouge">vPortSVCHandler()</code> is called, it means the FreeRTOS scheduler is launched. In other words, it is used to launch the very first task. In its name, SVC stands for ‘Supervisor Call’ exception.</p> <h3 id="3-context-switching-xportpendsvhandler">3. Context Switching: <code class="language-plaintext highlighter-rouge">xPortPendSVHandler()</code> </h3> <p>If you are using a type of processor other than ARM Cortex-M processors, you won’t see such function in your program, because <code class="language-plaintext highlighter-rouge">xPortPendSVHandler()</code> is specifically designed for ARM Cortex-M processors. For my project, I am using STM32F429I and STM32F4 series of MCUs are all based on ARM Cortex-M4 processors.</p> <p><code class="language-plaintext highlighter-rouge">xPortPendSVHandler()</code> enables <strong>context switching</strong> between tasks. What is context switching? In short, when computer needs to switch from Task A to Task B, it needs to save the ‘context’ of the previous task (Task A) as seen in the illustration<sup id="fnref:2"><a href="#fn:2" class="footnote" rel="footnote" role="doc-noteref">3</a></sup>.</p> <p><code class="language-plaintext highlighter-rouge">xPortPendSVHandler()</code> is triggered by pending the PendSV system exception of ARM. In its name, PendSV stands for ‘Pendable Service’.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/post-attachments/Scheduler/context-switch-480.webp 480w,/assets/post-attachments/Scheduler/context-switch-800.webp 800w,/assets/post-attachments/Scheduler/context-switch-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/post-attachments/Scheduler/context-switch.png" class="img-fluid rounded z-depth-1 center-image" width="300px" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h3 id="4-handles-tick-relevant-tasks-xportsystickhandler">4. Handles tick-relevant tasks: <code class="language-plaintext highlighter-rouge">xPortSysTickHandler()</code> </h3> <p>When tick occurs (in other words, when SysTick interrupt occurs) <code class="language-plaintext highlighter-rouge">xPortSysTickHandler()</code> is called. So <code class="language-plaintext highlighter-rouge">xPortSysTickHandler()</code> is another name for SysTick interrupt handler. It is also ARM Cortex-M microcontroller specific. <code class="language-plaintext highlighter-rouge">xPortSysTickHandler()</code> performs several essential tasks:</p> <ul> <li>Increments tick count <code class="language-plaintext highlighter-rouge">xTickCount</code> </li> <li>Checks if a context switch is required, and triggers it using PendSV interrupts</li> <li>If tickless idle mode is enabled, it adjusts the tick count to account for time spent in low-power states.</li> </ul> <p>There is another important function named <code class="language-plaintext highlighter-rouge">vPortSetupTimerInterrupt()</code> in <code class="language-plaintext highlighter-rouge">xPortSysTickHandler</code>. It configures the timer used for RTOS tick.</p> <h2 id="freertos-kernel-interrupts">FreeRTOS Kernel Interrupts</h2> <p>Interrupt is a fundamental mechanism in OS to stop and resume scheduler tasks. FreeRTOS has the following “kernel” interrupts:</p> <ol> <li>SVCInterrupt: SVC handler will be used to launch the very first task.</li> <li>PendSVInterrupt: PendSV handler is used to carry out context switching between tasks.</li> <li>SysTick Interrupt: SysTick handler implements the RTOS Tick Management.</li> </ol> <p>If SysTick interrupt is used for some other purposes in your application, then you may have to use any other available timer peripheral. All interrupts are configured at the lowest interrupt priority possible.</p> <h2 id="why-is-systick-timer-important">Why is SysTick Timer important?</h2> <p>In FreeRTOSConfig.h, there is a variable called <code class="language-plaintext highlighter-rouge">configTICK_RATE_HZ</code>. It means the interrupt is fired by SysTick timer for every 1ms (1000 times per second = every 1 millisecond). This sets how often a SysTick interrupt occurs. In depth, RTOS ticking is implemented using timer hardware of the MCU.</p> <p>To keep track of time. xTickCount variable is a key. For example, it is used for vTaskDelay(100).</p> <p>RTOS tick, apart from incrementing the tick count, is used to trigger the context switch to the next potential task.</p> <ol> <li>The tick ISR runs</li> <li>All the ready state tasks are scanned</li> <li>Determines which is the next potential task to run</li> <li>If found, triggers the context switching by pending the PendSV interrupt</li> <li>The PendSV handler takes care of switching out of old task and switching in of new task</li> </ol> <p>Let’s go to <code class="language-plaintext highlighter-rouge">port.c</code> and see xPortSysTickHandler.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td> <td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">xPortSysTickHandler</span><span class="p">(</span> <span class="kt">void</span> <span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* The SysTick runs at the lowest interrupt priority, so when this interrupt
	executes all interrupts must be unmasked.  There is therefore no need to
	save and then restore the interrupt mask value as its value is already
	known. */</span>
	<span class="n">portDISABLE_INTERRUPTS</span><span class="p">();</span>
	<span class="p">{</span>
		<span class="cm">/* Increment the RTOS tick. */</span>
		<span class="k">if</span><span class="p">(</span> <span class="n">xTaskIncrementTick</span><span class="p">()</span> <span class="o">!=</span> <span class="n">pdFALSE</span> <span class="p">)</span>
		<span class="p">{</span>
			<span class="cm">/* A context switch is required.  Context switching is performed in
			the PendSV interrupt.  Pend the PendSV interrupt. */</span>
			<span class="n">portNVIC_INT_CTRL_REG</span> <span class="o">=</span> <span class="n">portNVIC_PENDSVSET_BIT</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">portENABLE_INTERRUPTS</span><span class="p">();</span>
<span class="p">}</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>First, it increments the tick. In this example CPU clock is set to 16MHz, and <code class="language-plaintext highlighter-rouge">configTICK_RATE_HZ</code> is set to 1000.</p> \[16 \times 10^6 \div 1,000 = 16,000\] <p>As the SysTick timer starts, it counts down from 15,999 to 0. It generates an interrupt when the count value reaches 0 and again reloads the load count value. Therefore, 15,999 is the SysTick load value required to generate interrupt for every 1ms.</p> <h2 id="references">References</h2> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:3"> <p>https://www.freertos.org/Documentation/02-Kernel/05-RTOS-implementation-tutorial/02-Building-blocks/03-The-RTOS-tick <a href="#fnref:3" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:1"> <p>https://www.freertos.org/Documentation/01-FreeRTOS-quick-start/01-Beginners-guide/03-Build-your-first-project <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:2"> <p>https://www.techtarget.com/whatis/definition/context-switch <a href="#fnref:2" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Sean Kim. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>