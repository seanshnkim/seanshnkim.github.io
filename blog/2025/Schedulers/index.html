<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Schedulers | Sean Kim </title> <meta name="author" content="Sean Kim"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://seanshnkim.github.io/blog/2025/Schedulers/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Sean</span> Kim </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/post/index.html">post </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Schedulers</h1> <p class="post-meta"> Created in February 15, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/schedulers"> <i class="fa-solid fa-hashtag fa-sm"></i> Schedulers</a>   ·   <a href="/blog/category/rtos"> <i class="fa-solid fa-tag fa-sm"></i> RTOS</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="what-are-schedulers">What are schedulers?</h2> <ul> <li>vPortSVCHandler()</li> <li>xPortPendSVHandler()</li> <li>xPortSysTickHandler()</li> </ul> <h3 id="what-does-vportsvchandler-do">What does vPortSVCHandler() do?</h3> <p>It is used to launch the very first task. It is triggered by SVC Instruction</p> <h3 id="what-does-xportpendsvhandler-do">What does xPortPendSVHandler() do?</h3> <p>It is used to achieve the <strong>context switching</strong> between tasks. It triggered by pending the PendSV System exception of ARM.</p> <h3 id="what-does-xportsystickhandler-do">What does xPortSysTickHandler() do?</h3> <p>This implements the RTOS Tick management. Triggered periodically by Systick timer of ARM cortex Mx processor.</p> <h3 id="portc-is-important">port.c is important</h3> <p>These are all found in port.c</p> <h3 id="vtaskstartscheduler">vTaskStartScheduler()</h3> <p>This is implemented in tasks.c of FreeRTOS kernel and used to start the RTOS scheduler.</p> <blockquote> <p>A FreeRTOS application will start up and execute just like a non-RTOS application until <a href="https://www.freertos.org/Documentation/02-Kernel/04-API-references/04-RTOS-kernel-control/03-vTaskStartScheduler" rel="external nofollow noopener" target="_blank">vTaskStartScheduler()</a> is called. vTaskStartScheduler() is normally called from the application’s main() function. The RTOS only controls the execution sequencing after vTaskStartScheduler() has been called. <sup id="fnref:1"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup></p> </blockquote> <p>What does vTaskStartScheduler() create? It creates the idle and timer daemon task.</p> <p>What does vTaskStartScheduler() call? It calls xPortStartScheduler() to do the architecture specific initializations. xPortStartScheduler() is actually in port.c</p> <p>1) Configure sysTick timer to issue interrupts at desired rate. This is configured in FreeRTOSConfig.h -&gt; configTick_RATE_HZ (<code class="language-plaintext highlighter-rouge">vPortSetupTimerInterrupt()</code>) 2) Configures the priority for PendSV and Systick interrupts (<code class="language-plaintext highlighter-rouge">portNVIC_SHPR3_REG |= portNVIC_PENDSV_PRI</code>, <code class="language-plaintext highlighter-rouge">portNVIC_SHPR3_REG |= portNVIC_SYSTICK_PRI</code>) 3) Starts the first task by executing the SVC instruction (<code class="language-plaintext highlighter-rouge">prvPortStartFirstTask</code>)</p> <p>In <code class="language-plaintext highlighter-rouge">prvPortStartFirstTask</code>, it will execute SVC instruction</p> <p>SVC Handler will execute.</p> <p>vPortSVCHandler() PendSVHandler() SysTickHandler()</p> <h2 id="freertos-kernel-interrupts">FreeRTOS Kernel Interrupts</h2> <p>When FreeRTOS runs on ARM Cortex Mx Processor based MCU, below interrupts are used to implement the scheduling of tasks.</p> <ol> <li>SVCInterrupt (SVC handler will be used to launch the very first task)</li> <li>PendSVInterrupt (PendSV handler is used to carry out context switching between tasks)</li> <li>SysTick Interrupt (SysTick handler implements the RTOS Tick Management)</li> </ol> <p>If SysTick interrupt is used for some other purpose in your application, then you may use any other available timer peripheral.</p> <p>All interrupts are configured at the lowest interrupt priority possible.</p> <h2 id="why-is-systick-timer-important-how-do-we-set-the-timer">Why is SysTick Timer important? How do we set the timer?</h2> <p>In FreeRTOSConfig.h, there is a variable called <code class="language-plaintext highlighter-rouge">configTICK_RATE_HZ</code> portTickType 1000 -&gt; It means interrupt is fired by SysTick timer for every 1ms</p> <p>This sets how often interrupts are “fired” (It is fired by systick timer)</p> <p>RTOS ticking is implemented using timer hardware of the MCU</p> <p>To keep track of time. xTickCount variable is a key. For example, it is used for vTaskDelay(100).</p> <p>RTOS tick, apart from incrementing the tick count, is used to trigger the context switch to the next potential task.</p> <ol> <li>The tick ISR runs</li> <li>All the ready state tasks are scanned</li> <li>Determines which is the next potential task to run</li> <li>If found, triggers the context switching by pending the PendSV interrupt</li> <li>The PendSV handler takes care of switching out of old task and switching in of new task</li> </ol> <p>Let’s go to <code class="language-plaintext highlighter-rouge">port.c</code> and see xPortSysTickHandler. First, increment the tick.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td> <td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">xPortSysTickHandler</span><span class="p">(</span> <span class="kt">void</span> <span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* The SysTick runs at the lowest interrupt priority, so when this interrupt
	executes all interrupts must be unmasked.  There is therefore no need to
	save and then restore the interrupt mask value as its value is already
	known. */</span>
	<span class="n">portDISABLE_INTERRUPTS</span><span class="p">();</span>
	<span class="p">{</span>
		<span class="cm">/* Increment the RTOS tick. */</span>
		<span class="k">if</span><span class="p">(</span> <span class="n">xTaskIncrementTick</span><span class="p">()</span> <span class="o">!=</span> <span class="n">pdFALSE</span> <span class="p">)</span>
		<span class="p">{</span>
			<span class="cm">/* A context switch is required.  Context switching is performed in
			the PendSV interrupt.  Pend the PendSV interrupt. */</span>
			<span class="n">portNVIC_INT_CTRL_REG</span> <span class="o">=</span> <span class="n">portNVIC_PENDSVSET_BIT</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">portENABLE_INTERRUPTS</span><span class="p">();</span>
<span class="p">}</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>xTaskIncrementTick() returns <code class="language-plaintext highlighter-rouge">xSwitchRequired</code>. Then what does xPortSysTickHandler() do?</p> <p>The SysTick timer when started, down counts from 24999 to 0. It generates an interrupt when the count value reaches 0 and again reloads the load count value.</p> <p>So, 24999 is the systick load value required to generate interrupt for every 1ms (1000Hz)</p> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:1"> <p>https://www.freertos.org/Documentation/01-FreeRTOS-quick-start/01-Beginners-guide/03-Build-your-first-project <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Sean Kim. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>